{% extends 'AppBundle::layout.html.twig' %}

{% block title %}
    {{ battle.name }}
{% endblock %}

{% block body %}
    <div class="jumbotron">
        {% if app.user == battle.createur and battle.canceled == false %}
            <div class="pull-right">
                <a href="{{ path('battle_edit', {'slug': battle.slug}) }}" class="btn btn-xs btn-default"><span class="glyphicon glyphicon-edit"></span></a>
                <a href="#{{ battle.slug }}_canceled" data-toggle="modal" class="btn btn-xs btn-danger">Annuler la bataille</a>
            </div>
        {%  elseif is_granted('ROLE_ADMIN') and battle.canceled == true%}
            <div class="pull-right">
                <a href="#{{ battle.slug }}_delete" class="btn btn-xs btn-danger" data-toggle="modal"><span class="glyphicon glyphicon-trash"></span></a>
            </div>
        {% endif %}
        <h2>{{ battle.name }} du {{ battle.date|date('d/m/Y à h:i') }}</h2>
        <p>
            Bataille proposée par {{ battle.createur.username }} qui aura lieu chez {{ battle.lieu }}
        </p>
        <div id="{{ visiteur.presence.id }}" class="well" hidden>
            {{ form_start(form,{'attr':{'class':'form-horizontal'}}) }}
            {{ form_errors(form) }}

            <div class="form-group">
                {{ form_label(form.presence) }}
                <div class="col-sm-8">
                    {{ form_widget(form.presence,{'attr':{'class':'form-control'}}) }}
                    {{ form_errors(form.presence) }}
                </div>
            </div>
            <div id="army" class="form-group">
                {{ form_label(form.army) }}
                <div class="col-sm-8">
                    {{ form_widget(form.army,{'attr':{'class':'form-control'}}) }}
                    {{ form_errors(form.army) }}
                </div>
            </div>
            <div class="text-center">{{ form_widget(form.save,{'attr':{'class':'btn btn-default btn-xs'}}) }}</div>
            {{ form_rest(form) }}
            {{  form_end(form) }}
        </div>
        <div id="participant">

        </div>
        <div id="participants">


            <ul class="list-unstyled">
                <li id="participant">Vous {{ visiteur.presence.presence }} {% if visiteur.presence.id == 3 %} au commande de <a href="{{ path('army_view', {'slug': visiteur.army.slug}) }}">{{ visiteur.army.name }}</a>{%  endif %} <small><a id="cachePresence" href="#">Modifier votre réponse</a></small></li>
                {% for participant in participants %}
                    <li>{{ participant.participant.username }}
                        {% if participant.presence.id == 1  %} seras présent
                        {% elseif participant.presence.id == 2 %} ne seras pas présent
                        {% elseif participant.presence.id== 3  %} sera le général de l'armée {% if participant.presence.id == 3 %}<a href="{{ path('army_view', {'slug': participant.army.slug}) }}">{{ participant.army.name }}</a>{%  endif %}
                        {% elseif participant.presence.id == 4 %} n'a pas encore répondu
                        {% endif %}
                        </li>
                    {% endfor %}
            </ul>
        </div>
    </div>
    {% if app.user == battle.createur %}
        {% include 'AppBundle:Modal:battle.canceled.html.twig' with {'battle': battle} %}
    {% elseif is_granted('ROLE_ADMIN') and battle.canceled == true %}
        {% include 'AppBundle:Modal:battle.delete.html.twig' with {'battle': battle} %}
    {% endif %}
{% endblock %}

{% block javascript %}
    {{ parent() }}
<script src="{{ asset('/public/js/cacheArmy.js') }}"></script>
    <script src="{{ asset('/public/js/cachePresence.js') }}"></script>
{% endblock %}